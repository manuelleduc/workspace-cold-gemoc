/*
 * generated by Xtext 2.10.0
 */
package fr.mleduc.formatting2

import com.google.inject.Inject
import fr.mleduc.explicitOperations.Artifact
import fr.mleduc.explicitOperations.Composition
import fr.mleduc.explicitOperations.Language
import fr.mleduc.explicitOperations.Model
import fr.mleduc.explicitOperations.Operation
import fr.mleduc.explicitOperations.OperationParameter
import fr.mleduc.services.ExplicitOperationsGrammarAccess
import org.eclipse.xtext.formatting2.AbstractFormatter2
import org.eclipse.xtext.formatting2.IFormattableDocument
import fr.mleduc.explicitOperations.LanguageDependency
import fr.mleduc.explicitOperations.Cardinality

class ExplicitOperationsFormatter extends AbstractFormatter2 {

	@Inject extension ExplicitOperationsGrammarAccess

	def dispatch void format(Model model, extension IFormattableDocument document) {
		for (Language languages : model.getLanguages()) {
			languages.format;
		}
		for (Operation operations : model.getOperations()) {
			operations.format;
		}
		for (Artifact artifacts : model.getArtifacts()) {
			artifacts.format;
		}
		for (Composition compositions : model.getCompositions()) {
			compositions.format;
		}
	}

	def dispatch void format(Operation operation, extension IFormattableDocument document) {

		interior(operation, [indent])

		operation.regionFor.keyword('inputs').append[newLine].append[indent]

		operation.inputs.forEach [
			format
//			interior(it, [indent])
			append[newLine]
		]
		operation.getOutput.format;
	}

	def dispatch void format(OperationParameter operationParameter, extension IFormattableDocument document) {
		interior(operationParameter, [indent])
		operationParameter.regionFor.keyword(':').prepend[noSpace].append[oneSpace]
		operationParameter.cardinality.format
	}

	def dispatch void format(Cardinality cardinality, extension IFormattableDocument document) {
		cardinality.regionFor.keyword('[').prepend[oneSpace].append[noSpace]
		cardinality.regionFor.keyword('..').prepend[noSpace].append[noSpace]
		cardinality.regionFor.keyword(']').prepend[noSpace]
	}

	def dispatch void format(Artifact artifact, extension IFormattableDocument document) {
		artifact.regionFor.keyword('artifact').append[oneSpace]
		artifact.regionFor.keyword(':').append[oneSpace].prepend[noSpace]
	}

	def dispatch void format(Language language, extension IFormattableDocument document) {
		interior(language, [indent])
		language.dependencies.forEach [
			format
			append[newLine]
		]
	}

	def dispatch void format(LanguageDependency languageDependency, extension IFormattableDocument document) {
		languageDependency.regionFor.keyword(':').prepend[noSpace].append[oneSpace]
	}

	def dispatch void format(Composition languageDependency, extension IFormattableDocument document) {
		languageDependency.regionFor.keyword('composition').append[oneSpace]
		languageDependency.regionFor.keyword('::').append[oneSpace].prepend[oneSpace]
		interior(
			languageDependency.regionFor.keyword('['),
			languageDependency.regionFor.keyword(']'),
			[indent]
		)

		for (compositionParameter : languageDependency.parameters) {
			compositionParameter.format
			compositionParameter.append[newLine]
		}
	}
}
